{% extends "base.html" %}

{% block content %}
<style>
    #loadingOverlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 9999;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
    }
</style>

<script>
    function showLoading() {
        // í¼ ìœ íš¨ì„± ê²€ì‚¬ (ë¹ˆ ê°’ì´ë©´ ë¡œë”© ì•ˆ ë„ì›€)
        const form = document.querySelector('form');
        if (form.checkValidity()) {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
    }
</script>

<div id="loadingOverlay">
    <div class="spinner-border text-info" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <h4 class="mt-3 fw-bold">ğŸ” êµ¬ê¸€ ê²€ìƒ‰ ë° AI ë¶„ì„ ì¤‘...</h4>
    <p class="text-white-50">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš” (ìµœëŒ€ 10ì´ˆ)</p>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card card-dark border-0 mb-4">
            <div class="card-body p-5">
                <h2 class="fw-bold mb-2 text-white">ğŸ“ í•™ê³¼ ê¸°ë°˜ ì§ë¬´ íƒìƒ‰</h2>
                <p class="text-secondary mb-4">
                    ìš°ë¦¬ ëŒ€í•™ ì „ê³µìœ¼ë¡œ ì–´ë–¤ ê¸°ì—…, ì–´ë–¤ ì§ë¬´ì— ê°ˆ ìˆ˜ ìˆì„ê¹Œìš”?<br>
                    AIê°€ ì‹¤ì‹œê°„ ì •ë³´ì™€ ì „ê³µ ì—­ëŸ‰ì„ ë§¤ì¹­í•´ ë“œë¦½ë‹ˆë‹¤.
                </p>

                <form method="POST" action="{{ url_for('career') }}" onsubmit="showLoading()">
                    
                    <div class="mb-4">
                        <label class="form-label text-info fw-bold">1. ë³¸ì¸ì˜ ì „ê³µì„ ì„ íƒí•˜ì„¸ìš”</label>
                        <select class="form-select bg-dark text-white border-secondary p-3" name="major" required>
                            <option value="">í•™ê³¼ ëª©ë¡ì—ì„œ ì„ íƒ...</option>
                            {% for category, major_list in majors.items() %}
                                <optgroup label="{{ category }}">
                                    {% for major in major_list %}
                                        <option value="{{ major }}" {% if sel_major == major %}selected{% endif %}>
                                            {{ major }}
                                        </option>
                                    {% endfor %}
                                </optgroup>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label text-success fw-bold">2. í¬ë§í•˜ëŠ” ê¸°ì—…ëª…ì„ ì…ë ¥í•˜ì„¸ìš”</label>
                        <input type="text" name="company" class="form-control bg-dark text-white border-secondary p-3" 
                               placeholder="ê¸°ì—…ëª…ì„ ì…ë ¥í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”" 
                               value="{{ sel_company if sel_company else '' }}" 
                               list="companyOptions" autocomplete="off" required>
                        
                        <datalist id="companyOptions">
                            {% for company in company_options %}
                                <option value="{{ company }}">
                            {% endfor %}
                        </datalist>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-ai btn-lg shadow-lg">
                            ğŸš€ ì‹¤ì‹œê°„ ë¶„ì„ ì‹œì‘í•˜ê¸°
                        </button>
                    </div>
                </form>
            </div>
        </div>

        {% if result %}
        <div class="card card-dark border-0 animate-slide-up">
            <div class="card-header border-secondary bg-transparent py-3">
                <h5 class="mb-0 text-white">
                    <span class="text-info fw-bold">{{ sel_major }}</span> ì „ê³µ 
                    <i class="bi bi-arrow-right mx-2">â†’</i> 
                    <span class="text-success fw-bold">{{ sel_company }}</span> ë¶„ì„ ê²°ê³¼
                </h5>
            </div>
            <div class="card-body p-4">
                <div class="ai-result">
                    {{ result | safe }}
                </div>
                
                <div class="mt-4 text-end">
                    <a href="{{ url_for('career') }}" class="btn btn-outline-secondary btn-sm">ì´ˆê¸°í™” / ë‹¤ì‹œ ê²€ìƒ‰</a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}