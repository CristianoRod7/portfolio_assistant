{% extends "base.html" %}
{% block content %}

<h1 class="text-3xl font-bold mb-6">
  Dashboard <span class="text-ai-purple">AI Insight</span>
</h1>

<!-- ìƒë‹¨ ì¹´ë“œ í†µê³„ -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">

  <!-- ì´ í™œë™ ê°œìˆ˜ -->
  <div class="bg-ai-gradient-1 bg-opacity-60 p-6 rounded-2xl shadow-xl border border-ai-purple">
      <p class="text-gray-300">ì´ í™œë™ ìˆ˜</p>
      <p class="text-4xl font-bold mt-2">{{ experiences|length }}</p>
  </div>

  <!-- ì´ ì‹œê°„ -->
  <div class="bg-ai-gradient-1 bg-opacity-60 p-6 rounded-2xl shadow-xl border border-ai-blue">
      <p class="text-gray-300">ì´ íˆ¬ì… ì‹œê°„</p>
      <p id="hoursCounter" class="text-4xl font-bold mt-2">0</p>
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ ê°œìˆ˜ -->
  <div class="bg-ai-gradient-1 bg-opacity-60 p-6 rounded-2xl shadow-xl border border-ai-purple-light">
      <p class="text-gray-300">ì¹´í…Œê³ ë¦¬ ìˆ˜</p>
      <p class="text-4xl font-bold mt-2">{{ categories|length }}</p>
  </div>

</div>

<!-- ğŸ”¥ ìµœê·¼ í™œë™ : ë©”ì¸ ì„¹ì…˜ -->
<div class="mb-10">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-bold">ìµœê·¼ í™œë™</h2>
    <span class="text-sm text-gray-400">ìµœì‹  5ê°œ í™œë™ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</span>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {% for exp in experiences[:5] %}
      <div class="bg-[#1a0a2e] p-5 rounded-xl border border-ai-purple-light shadow-lg hover:scale-[1.01] transition">
        <div class="flex justify-between items-start gap-3">
          <!-- ì™¼ìª½: í™œë™ ì •ë³´ -->
          <div>
            <h3 class="text-lg font-semibold text-ai-purple">
              <a href="{{ url_for('experience_detail', exp_id=exp['id']) }}">
                {{ exp['title'] }}
              </a>
            </h3>
            <p class="text-gray-400 text-sm mt-1">{{ exp['category'] }}</p>
            <p class="text-gray-300 mt-2 text-sm">
              {{ exp['start_date'] }} ~ {{ exp['end_date'] or "" }}
            </p>
            <p class="text-gray-400 mt-3 text-sm line-clamp-3">
              {{ exp['description'] }}
            </p>
          </div>

          <!-- ì˜¤ë¥¸ìª½: ì‚­ì œ ë²„íŠ¼ -->
          <form method="post"
                action="{{ url_for('delete_exp', exp_id=exp['id']) }}"
                onsubmit="return confirm('ì •ë§ ì´ í™œë™ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
            <button type="submit"
                    class="bg-red-600 hover:bg-red-700 text-white text-xs px-3 py-1 rounded-lg">
              ì‚­ì œ
            </button>
          </form>
        </div>
      </div>
      {% endfor %}

      {% if experiences|length == 0 %}
      <p class="text-gray-400">ì•„ì§ ë“±ë¡ëœ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ì˜ â€˜í™œë™ ì¶”ê°€â€™ë¥¼ ëˆŒëŸ¬ ì²« í™œë™ì„ ë“±ë¡í•´ ë³´ì„¸ìš”.</p>
      {% endif %}
  </div>
</div>

<!-- ğŸ“Š ì¹´í…Œê³ ë¦¬ ì°¨íŠ¸ : ì„œë¸Œ ì„¹ì…˜ -->
<div class="bg-[#120022] p-6 rounded-2xl shadow-xl border border-ai-purple">
    <h2 class="text-xl font-semibold mb-4">ì¹´í…Œê³ ë¦¬ ë¹„ìœ¨</h2>

    <!-- í¬ê¸° ì œí•œ + ê°€ìš´ë° ì •ë ¬ -->
    <div class="h-64 max-w-xl mx-auto">
        <canvas id="categoryChart"></canvas>
    </div>
</div>

<!-- ìŠ¤í¬ë¦½íŠ¸ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    /* ìˆ«ì ì¹´ìš´í„° */
    let total = {{ total_hours }};
    let el = document.getElementById("hoursCounter");

    let now = 0;
    let timer = setInterval(() => {
        now += Math.ceil(total / 50);
        if (now >= total) {
            now = total;
            clearInterval(timer);
        }
        el.innerText = now;
    }, 20);

    /* ì¹´í…Œê³ ë¦¬ ì°¨íŠ¸ */
    const ctx = document.getElementById('categoryChart').getContext('2d');

    const categoryLabels = {{ categories|map(attribute='category')|list|tojson }};
    const categoryCounts = {{ categories|map(attribute='cnt')|list|tojson }};

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: categoryLabels,
            datasets: [{
                data: categoryCounts,
                backgroundColor: [
                    '#7b3fe4', '#5cd4ff', '#ff4ecb', '#ff884d', '#b085ff'
                ],
                borderColor: 'transparent'
            }]
        },
        options: {
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: { color: '#ffffff' }
              }
            }
        }
    });
</script>

{% endblock %}
