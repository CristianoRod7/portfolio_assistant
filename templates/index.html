{% extends "base.html" %}
{% block content %}

<h1 class="mb-3 fw-bold">Dashboard <span class="text-info">AI Insight</span></h1>

<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card-dark p-3">
      <div class="text-muted small">총 활동 수</div>
      <div class="fs-3 fw-bold">{{ experiences|length }}</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card-dark p-3">
      <div class="text-muted small">총 투입 시간</div>
      <div class="fs-3 fw-bold">{{ total_hours }}</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card-dark p-3">
      <div class="text-muted small">카테고리 수</div>
      <div class="fs-3 fw-bold">{{ category_labels|length }}</div>
    </div>
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-7">
    <div class="card-dark p-3 mb-4">
      <h5 class="mb-3">카테고리 비율</h5>
      <canvas id="categoryChart" height="260"></canvas>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card-dark p-3 mb-4">
      <h5 class="mb-3">최근 활동</h5>
      {% if recent_experiences %}
        <div class="list-group list-group-flush">
          {% for exp in recent_experiences %}
          <a href="{{ url_for('experience_detail', exp_id=exp['id']) }}"
             class="list-group-item list-group-item-action bg-transparent text-light border-secondary">
            <div class="d-flex justify-content-between">
              <div>
                <span class="badge badge-ai me-2">{{ exp['category'] }}</span>
                <strong>{{ exp['title'] }}</strong>
              </div>
              <small class="text-muted">{{ exp['start_date'] }} ~ {{ exp['end_date'] or '' }}</small>
            </div>
          </a>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted">아직 등록된 활동이 없습니다.</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
  const labels = {{ category_labels | tojson }};
  const counts = {{ category_counts | tojson }};

  const ctx = document.getElementById('categoryChart').getContext('2d');
  new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: labels,
      datasets: [{
        data: counts,
        backgroundColor: [
          '#7c3aed', '#22c55e', '#eab308', '#f97316', '#22d3ee', '#ec4899'
        ],
        borderWidth: 0
      }]
    },
    options: {
      plugins: {
        legend: {
          labels: { color: '#e5e7eb' }
        }
      }
    }
  });
</script>

{% endblock %}
