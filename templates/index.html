{% extends "base.html" %}
{% block content %}

<!-- ìƒë‹¨ í—¤ë” -->
<div class="d-flex justify-content-between align-items-end mb-4">
  <div>
    <h1 class="h3 fw-bold mb-1">Dashboard</h1>
    <p class="text-secondary small mb-0">ë‚´ í¬íŠ¸í´ë¦¬ì˜¤ í˜„í™©íŒ</p>
  </div>
  
  <!-- â–¼â–¼â–¼ ê´€ë¦¬ì(ë¡œê·¸ì¸)ì¼ ë•Œë§Œ ì¶”ê°€ ë²„íŠ¼ í‘œì‹œ â–¼â–¼â–¼ -->
  {% if logged_in %}
    <a href="{{ url_for('add') }}" class="btn btn-ai btn-sm px-3">+ ìƒˆ í™œë™ ì¶”ê°€</a>
  {% endif %}
  <!-- â–²â–²â–² -->
</div>

<!-- ë©”ì¸ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ -->
<div class="row g-3">
  
  <!-- 1. í†µê³„ ì¹´ë“œ -->
  <div class="col-12 col-lg-8">
    <div class="row g-3 h-100">
      <div class="col-md-4">
        <div class="card card-dark p-4 h-100 d-flex flex-column justify-content-center text-center">
          <span class="display-5 fw-bold text-white">{{ total_count or 0 }}</span>
          <span class="small text-secondary text-uppercase tracking-wider">Projects</span>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-dark p-4 h-100 d-flex flex-column justify-content-center text-center">
          <span class="display-5 fw-bold text-white">{{ total_hours or 0 }}</span>
          <span class="small text-secondary text-uppercase tracking-wider">Hours</span>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-dark p-4 h-100 d-flex flex-column justify-content-center text-center">
          <span class="display-5 fw-bold text-white">{{ categories|length }}</span>
          <span class="small text-secondary text-uppercase tracking-wider">Categories</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 2. AI í€µ ì•¡ì…˜ -->
  <div class="col-12 col-lg-4">
    <div class="card card-dark p-4 h-100">
      <h6 class="text-uppercase text-secondary small fw-bold mb-3">AI Assistant Tools</h6>
      <div class="d-grid gap-2">
        <a href="{{ url_for('analyze') }}" class="btn btn-outline-light btn-sm text-start py-2">
          ğŸ”® ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ ì§„ë‹¨
        </a>
        <a href="{{ url_for('company_analyze') }}" class="btn btn-outline-light btn-sm text-start py-2">
          ğŸ¢ ê¸°ì—…ë³„ í•©ê²© í™•ë¥  ë¶„ì„
        </a>
        <a href="{{ url_for('resume') }}" class="btn btn-outline-light btn-sm text-start py-2">
          ğŸ“„ ì´ë ¥ì„œ í•µì‹¬ ê²½ë ¥ ìƒì„±
        </a>
        <a href="{{ url_for('cover_letter') }}" class="btn btn-outline-light btn-sm text-start py-2">
          âœï¸ ìê¸°ì†Œê°œì„œ ì´ˆì•ˆ ì‘ì„±
        </a>
      </div>
    </div>
  </div>

  <!-- 3. ìŠ¤í‚¬ ë ˆì´ë” ì°¨íŠ¸ -->
  <div class="col-12">
    <div class="card card-dark p-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold mb-0 text-white">My Skill Radar</h5>
        <span class="badge bg-secondary bg-opacity-25 text-secondary">Auto-generated</span>
      </div>
      <div style="position: relative; height: 300px; width: 100%; display: flex; justify-content: center;">
        <canvas id="skillChart"></canvas>
      </div>
    </div>
  </div>

  <!-- 4. í™œë™ ëª©ë¡ ë¦¬ìŠ¤íŠ¸ -->
  <div class="col-12">
    <div class="card card-dark p-4">
      <h5 class="mb-4 fw-bold">Recent Activities</h5>
      {% if experiences %}
      <div class="table-responsive">
        <table class="table table-dark table-hover mb-0" style="--bs-table-bg: transparent;">
          <thead>
            <tr class="text-secondary small text-uppercase">
              <th>Status</th>
              <th>Title</th>
              <th>Category</th>
              <th>Duration</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for exp in experiences %}
            <tr>
              <td class="align-middle">
                <span class="badge rounded-pill bg-{{ exp.status_color }} bg-opacity-10 text-{{ exp.status_color }}">
                  {{ exp.status_label }}
                </span>
              </td>
              <td class="align-middle fw-semibold">{{ exp.title }}</td>
              <td class="align-middle text-secondary small">{{ exp.category }}</td>
              <td class="align-middle text-secondary small">
                {{ exp.start_date }} ~
              </td>
              <td class="text-end">
                <a href="{{ url_for('experience_detail', exp_id=exp.id) }}" class="btn btn-sm btn-link text-decoration-none text-white">View â†’</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <div class="text-center py-5 text-secondary">
          ì•„ì§ ë“±ë¡ëœ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤. <br>ìš°ì¸¡ ìƒë‹¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ê°€í•´ë³´ì„¸ìš”!
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const skillCounts = {};
  {% for exp in experiences %}
    var skillsRaw = "{{ exp.skills or '' }}";
    if (skillsRaw) {
      var skills = skillsRaw.split(',');
      skills.forEach(function(s) {
        var key = s.trim();
        if(key) { skillCounts[key] = (skillCounts[key] || 0) + 1; }
      });
    }
  {% endfor %}
  let labels = Object.keys(skillCounts);
  let dataPoints = Object.values(skillCounts);
  if (labels.length === 0) {
    labels = ['Python', 'Communication', 'Data Analysis', 'Problem Solving', 'Teamwork'];
    dataPoints = [4, 3, 5, 4, 3];
  }
  const ctx = document.getElementById('skillChart');
  if (ctx) {
    new Chart(ctx, {
      type: 'radar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Skill Relevance',
          data: dataPoints,
          backgroundColor: 'rgba(139, 92, 246, 0.2)',
          borderColor: '#8b5cf6',
          pointBackgroundColor: '#fff',
          pointBorderColor: '#8b5cf6',
          borderWidth: 2,
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: '#8b5cf6'
        }]
      },
      options: {
        maintainAspectRatio: false,
        elements: { line: { tension: 0.3 } },
        scales: {
          r: {
            angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
            grid: { color: 'rgba(255, 255, 255, 0.1)' },
            pointLabels: { color: '#cbd5e1', font: { size: 12, family: "'Inter', sans-serif" } },
            ticks: { display: false, backdropColor: 'transparent' },
            suggestedMin: 0, suggestedMax: 5
          }
        },
        plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(0, 0, 0, 0.8)', titleColor: '#fff', bodyColor: '#fff', padding: 10, cornerRadius: 8, displayColors: false } }
      }
    });
  }
});
</script>
{% endblock %}