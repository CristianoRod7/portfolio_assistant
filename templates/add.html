{% extends "base.html" %}
{% block content %}

<style>
  /* ë³„ì  ìŠ¤íƒ€ì¼ */
  .star-rating .bi {
    font-size: 1.5rem;
    color: #6c757d; /* ê¸°ë³¸ íšŒìƒ‰ */
    cursor: pointer;
    transition: color 0.2s;
  }
  .star-rating .bi.active {
    color: #ffc107; /* í™œì„±í™”ëœ ë…¸ë€ìƒ‰ */
  }
  .star-rating .bi:hover {
    color: #ffdb72; /* í˜¸ë²„ ì‹œ ì—°í•œ ë…¸ë€ìƒ‰ */
  }
</style>

<div class="row justify-content-center">
  <div class="col-lg-8">
    
    <div class="d-flex align-items-center mb-4">
      <a href="{{ url_for('index') }}" class="btn btn-sm btn-outline-secondary me-3">â† ë’¤ë¡œ</a>
      <h2 class="h4 mb-0 fw-bold">{% if is_edit %}í™œë™ ìˆ˜ì •{% else %}ìƒˆ í™œë™ ì¶”ê°€{% endif %}</h2>
    </div>

    <div class="card card-dark p-4 p-md-5 animate-slide-up">
      <form method="post" id="activityForm" onsubmit="showLoading()">
        
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label class="form-label text-secondary small">ì¹´í…Œê³ ë¦¬</label>
            <input type="text" name="category" list="categoryOptions" 
                   class="form-control bg-dark text-white border-secondary" 
                   placeholder="ì„ íƒ ë˜ëŠ” ì§ì ‘ ì…ë ¥" 
                   value="{{ exp.category if exp else '' }}" required autocomplete="off">
            <datalist id="categoryOptions">
              <option value="ê°œì¸ í”„ë¡œì íŠ¸">
              <option value="íŒ€ í”„ë¡œì íŠ¸">
              <option value="ì¸í„´/í˜„ì¥ì‹¤ìŠµ">
              <option value="ê²½ì§„ëŒ€íšŒ/ê³µëª¨ì „">
              <option value="í•´ì»¤í†¤">
              <option value="ìê²©ì¦/ì–´í•™">
              <option value="í•™íšŒ/ì„¸ë¯¸ë‚˜">
              <option value="ë™ì•„ë¦¬/í•™ìƒíšŒ">
              <option value="ë´‰ì‚¬í™œë™">
              <option value="ì•„ë¥´ë°”ì´íŠ¸">
            </datalist>
          </div>
          <div class="col-md-8">
            <label class="form-label text-secondary small">í™œë™ëª… (Title)</label>
            <input type="text" name="title" class="form-control bg-dark text-white border-secondary" 
                   placeholder="í™œë™ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" 
                   value="{{ exp.title if exp else '' }}" required>
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label text-secondary small">ìƒì„¸ ë‚´ìš©</label>
          <textarea name="description" rows="6" class="form-control bg-dark text-white border-secondary"
                    placeholder="êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ì—­í• ì„ ë§¡ì•˜ê³ , ì–´ë–¤ ì„±ê³¼ë¥¼ ëƒˆë‚˜ìš”? (AI ë¶„ì„ì˜ í•µì‹¬ì´ ë©ë‹ˆë‹¤)">{{ exp.description if exp else '' }}</textarea>
        </div>

        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label class="form-label text-secondary small">ì‹œì‘ì¼</label>
            <input type="date" name="start_date" class="form-control bg-dark text-white border-secondary" 
                   value="{{ exp.start_date if exp else '' }}" required>
          </div>
          <div class="col-md-4">
            <label class="form-label text-secondary small">ì¢…ë£Œì¼ (ì§„í–‰ ì¤‘ì´ë©´ ë¹„ì›€)</label>
            <input type="date" name="end_date" class="form-control bg-dark text-white border-secondary"
                   value="{{ exp.end_date if exp else '' }}">
          </div>
          
          <div class="col-md-4">
            <label class="form-label text-warning small fw-bold">ë‚˜ë§Œì˜ ì¤‘ìš”ë„ (Priority)</label>
            <div class="d-flex align-items-center star-rating mt-1" id="starContainer">
                <i class="bi bi-star-fill me-1" data-value="1"></i>
                <i class="bi bi-star-fill me-1" data-value="2"></i>
                <i class="bi bi-star-fill me-1" data-value="3"></i>
                <i class="bi bi-star-fill me-1" data-value="4"></i>
                <i class="bi bi-star-fill me-1" data-value="5"></i>
            </div>
            <input type="hidden" name="hours" id="ratingInput" value="{{ exp.hours if exp else '3' }}">
            <div class="form-text text-secondary" style="font-size: 0.7rem;">
                * í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œì˜ ì¤‘ìš”ë„ë¥¼ 5ì  ë§Œì ìœ¼ë¡œ í‰ê°€
            </div>
          </div>
          </div>

        <div class="mb-4">
          <label class="form-label text-secondary small">ì‚¬ìš© ê¸°ìˆ  / í‚¤ì›Œë“œ</label>
          
          <div id="tagsContainer" class="d-flex flex-wrap gap-2 mb-2"></div>
          
          <div class="input-group">
            <input type="text" id="skillInput" list="techOptions"
                   class="form-control bg-dark text-white border-secondary" 
                   placeholder="ê¸°ìˆ  ì…ë ¥ í›„ Enter ë˜ëŠ” ì¶”ê°€ ë²„íŠ¼ í´ë¦­" autocomplete="off">
            <button class="btn btn-outline-secondary" type="button" id="addSkillBtn">ì¶”ê°€</button>
          </div>

          <input type="hidden" name="skills" id="realSkillsInput" value="{{ exp.skills if exp else '' }}">

          <datalist id="techOptions">
            <option value="Python"><option value="Java"><option value="JavaScript">
            <option value="TypeScript"><option value="React"><option value="Vue.js">
            <option value="Spring Boot"><option value="Django"><option value="Flask">
            <option value="Node.js"><option value="SQL"><option value="NoSQL">
            <option value="AWS"><option value="Docker"><option value="Git">
            <option value="Figma"><option value="Data Analysis"><option value="Machine Learning">
            <option value="C++"><option value="C#"><option value="Unity">
          </datalist>
          <div class="form-text text-secondary small">
            * ëª©ë¡ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥ í›„ <strong>Enter</strong>ë¥¼ ëˆ„ë¥´ì„¸ìš”.
          </div>
        </div>

        <div class="mb-5">
          <label class="form-label text-secondary small">ğŸ”— ì¦ë¹™ ìë£Œ ë§í¬</label>
          <input type="url" name="link" class="form-control bg-dark text-white border-secondary" 
                 placeholder="https://..." 
                 value="{{ exp.link if exp and exp.link else '' }}">
        </div>

        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-ai py-3 fw-bold">
            {% if is_edit %}ìˆ˜ì • ì™„ë£Œ{% else %}í™œë™ ì €ì¥í•˜ê¸°{% endif %}
          </button>
          {% if is_edit %}
            <a href="{{ url_for('experience_detail', exp_id=exp.id) }}" class="btn btn-outline-secondary">ì·¨ì†Œ</a>
          {% endif %}
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  
  // === [1] ë³„ì  ë¡œì§ ===
  const starContainer = document.getElementById('starContainer');
  const ratingInput = document.getElementById('ratingInput');
  const stars = starContainer.querySelectorAll('i');

  function updateStars(value) {
    stars.forEach(star => {
      const starVal = parseInt(star.getAttribute('data-value'));
      if (starVal <= value) {
        star.classList.add('active');
        star.classList.remove('bi-star');
        star.classList.add('bi-star-fill');
      } else {
        star.classList.remove('active');
        star.classList.remove('bi-star-fill');
        star.classList.add('bi-star');
      }
    });
  }

  // ì´ˆê¸°ê°’ ì„¤ì •
  updateStars(parseInt(ratingInput.value || 3));

  // í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
  stars.forEach(star => {
    star.addEventListener('click', function() {
      const val = this.getAttribute('data-value');
      ratingInput.value = val;
      updateStars(val);
    });
  });


  // === [2] íƒœê·¸(ê¸°ìˆ ìŠ¤íƒ) ë¡œì§ ===
  const skillInput = document.getElementById('skillInput');
  const tagsContainer = document.getElementById('tagsContainer');
  const realInput = document.getElementById('realSkillsInput');
  const addBtn = document.getElementById('addSkillBtn');

  let skills = [];
  if (realInput.value) {
    skills = realInput.value.split(',').map(s => s.trim()).filter(s => s);
    renderTags();
  }

  function addSkill() {
    const val = skillInput.value.trim();
    if (!val) return;
    if (!skills.includes(val)) {
      skills.push(val);
      updateRealInput();
      renderTags();
    }
    skillInput.value = ''; 
    skillInput.focus();
  }

  function renderTags() {
    tagsContainer.innerHTML = '';
    skills.forEach((skill, index) => {
      const tag = document.createElement('span');
      tag.className = 'badge bg-info bg-opacity-10 text-info border border-info border-opacity-25 py-2 px-3 rounded-pill d-flex align-items-center';
      tag.innerHTML = `
        ${skill}
        <span class="ms-2 cursor-pointer text-white-50 hover-white" onclick="removeSkill(${index})" style="cursor:pointer;">&times;</span>
      `;
      tagsContainer.appendChild(tag);
    });
  }

  window.removeSkill = function(index) {
    skills.splice(index, 1);
    updateRealInput();
    renderTags();
  };

  function updateRealInput() {
    realInput.value = skills.join(', ');
  }

  skillInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault(); 
      addSkill();
    }
  });

  addBtn.addEventListener('click', addSkill);
});
</script>

{% endblock %}