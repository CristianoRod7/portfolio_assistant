{% extends "base.html" %}
{% block content %}

<div class="row justify-content-center">
  <div class="col-lg-8">
    
    <div class="d-flex align-items-center mb-4">
      <a href="{{ url_for('index') }}" class="btn btn-sm btn-outline-secondary me-3">â† ë’¤ë¡œ</a>
      <h2 class="h4 mb-0 fw-bold">{% if is_edit %}í™œë™ ìˆ˜ì •{% else %}ìƒˆ í™œë™ ì¶”ê°€{% endif %}</h2>
    </div>

    <div class="card card-dark p-4 p-md-5">
      <form method="post" id="activityForm">
        
        <!-- ì¹´í…Œê³ ë¦¬ & ì œëª© -->
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label class="form-label text-secondary small">ì¹´í…Œê³ ë¦¬</label>
            <input type="text" name="category" list="categoryOptions" 
                   class="form-control bg-dark text-white border-secondary" 
                   placeholder="ì„ íƒ ë˜ëŠ” ì§ì ‘ ì…ë ¥" 
                   value="{{ exp.category if exp else '' }}" required autocomplete="off">
            <datalist id="categoryOptions">
              <option value="ê°œì¸ í”„ë¡œì íŠ¸">
              <option value="íŒ€ í”„ë¡œì íŠ¸">
              <option value="ì¸í„´/í˜„ì¥ì‹¤ìŠµ">
              <option value="ê²½ì§„ëŒ€íšŒ/ê³µëª¨ì „">
              <option value="í•´ì»¤í†¤">
              <option value="ìê²©ì¦/ì–´í•™">
              <option value="í•™íšŒ/ì„¸ë¯¸ë‚˜">
              <option value="ë™ì•„ë¦¬/í•™ìƒíšŒ">
              <option value="ë´‰ì‚¬í™œë™">
              <option value="ì•„ë¥´ë°”ì´íŠ¸">
            </datalist>
          </div>
          <div class="col-md-8">
            <label class="form-label text-secondary small">í™œë™ëª… (Title)</label>
            <input type="text" name="title" class="form-control bg-dark text-white border-secondary" 
                   placeholder="í™œë™ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" 
                   value="{{ exp.title if exp else '' }}" required>
          </div>
        </div>

        <!-- ì„¤ëª… -->
        <div class="mb-4">
          <label class="form-label text-secondary small">ìƒì„¸ ë‚´ìš©</label>
          <textarea name="description" rows="6" class="form-control bg-dark text-white border-secondary"
                    placeholder="êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ì—­í• ì„ ë§¡ì•˜ê³ , ì–´ë–¤ ì„±ê³¼ë¥¼ ëƒˆë‚˜ìš”? (AI ë¶„ì„ì˜ í•µì‹¬ì´ ë©ë‹ˆë‹¤)">{{ exp.description if exp else '' }}</textarea>
        </div>

        <!-- ë‚ ì§œ & ì‹œê°„ -->
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label class="form-label text-secondary small">ì‹œì‘ì¼</label>
            <input type="date" name="start_date" class="form-control bg-dark text-white border-secondary" 
                   value="{{ exp.start_date if exp else '' }}" required>
          </div>
          <div class="col-md-4">
            <label class="form-label text-secondary small">ì¢…ë£Œì¼ (ì§„í–‰ ì¤‘ì´ë©´ ë¹„ì›€)</label>
            <input type="date" name="end_date" class="form-control bg-dark text-white border-secondary"
                   value="{{ exp.end_date if exp else '' }}">
          </div>
          <div class="col-md-4">
            <label class="form-label text-secondary small">íˆ¬ì… ì‹œê°„ (Hours)</label>
            <input type="number" name="hours" class="form-control bg-dark text-white border-secondary" 
                   placeholder="0" min="0" 
                   value="{{ exp.hours if exp else '' }}">
          </div>
        </div>

        <!-- â–¼â–¼â–¼ ê¸°ìˆ  ìŠ¤íƒ (ë©€í‹° íƒœê·¸ ì…ë ¥) â–¼â–¼â–¼ -->
        <div class="mb-4">
          <label class="form-label text-secondary small">ì‚¬ìš© ê¸°ìˆ  / í‚¤ì›Œë“œ</label>
          
          <!-- íƒœê·¸ë“¤ì´ í‘œì‹œë  ê³µê°„ -->
          <div id="tagsContainer" class="d-flex flex-wrap gap-2 mb-2"></div>
          
          <!-- ì‹¤ì œ ì…ë ¥ì„ ë°›ëŠ” visible input -->
          <div class="input-group">
            <input type="text" id="skillInput" list="techOptions"
                   class="form-control bg-dark text-white border-secondary" 
                   placeholder="ê¸°ìˆ  ì…ë ¥ í›„ Enter ë˜ëŠ” ì¶”ê°€ ë²„íŠ¼ í´ë¦­" autocomplete="off">
            <button class="btn btn-outline-secondary" type="button" id="addSkillBtn">ì¶”ê°€</button>
          </div>

          <!-- ì„œë²„ë¡œ ì „ì†¡ë  ì§„ì§œ ë°ì´í„° (ìˆ¨ê²¨ì§) -->
          <input type="hidden" name="skills" id="realSkillsInput" value="{{ exp.skills if exp else '' }}">

          <!-- ì¶”ì²œ ëª©ë¡ -->
          <datalist id="techOptions">
            <option value="Python"><option value="Java"><option value="JavaScript">
            <option value="TypeScript"><option value="React"><option value="Vue.js">
            <option value="Spring Boot"><option value="Django"><option value="Flask">
            <option value="Node.js"><option value="SQL"><option value="NoSQL">
            <option value="AWS"><option value="Docker"><option value="Git">
            <option value="Figma"><option value="Data Analysis"><option value="Machine Learning">
            <option value="C++"><option value="C#"><option value="Unity">
          </datalist>
          <div class="form-text text-secondary small">
            * ëª©ë¡ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥ í›„ <strong>Enter</strong>ë¥¼ ëˆ„ë¥´ì„¸ìš”.
          </div>
        </div>
        <!-- â–²â–²â–² -->

        <!-- ì¦ë¹™ ë§í¬ -->
        <div class="mb-5">
          <label class="form-label text-secondary small">ğŸ”— ì¦ë¹™ ìë£Œ ë§í¬</label>
          <input type="url" name="link" class="form-control bg-dark text-white border-secondary" 
                 placeholder="https://..." 
                 value="{{ exp.link if exp and exp.link else '' }}">
        </div>

        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-ai py-3 fw-bold">
            {% if is_edit %}ìˆ˜ì • ì™„ë£Œ{% else %}í™œë™ ì €ì¥í•˜ê¸°{% endif %}
          </button>
          {% if is_edit %}
            <a href="{{ url_for('experience_detail', exp_id=exp.id) }}" class="btn btn-outline-secondary">ì·¨ì†Œ</a>
          {% endif %}
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const skillInput = document.getElementById('skillInput');
  const tagsContainer = document.getElementById('tagsContainer');
  const realInput = document.getElementById('realSkillsInput');
  const addBtn = document.getElementById('addSkillBtn');

  // ì´ˆê¸° ë°ì´í„° ë¡œë“œ (ìˆ˜ì • ëª¨ë“œì¼ ë•Œ)
  let skills = [];
  if (realInput.value) {
    // ì½¤ë§ˆë¡œ ë¶„ë¦¬í•´ì„œ ë°°ì—´ë¡œ ë§Œë“¦ (ë¹ˆê°’ ì œê±°)
    skills = realInput.value.split(',').map(s => s.trim()).filter(s => s);
    renderTags();
  }

  // íƒœê·¸ ì¶”ê°€ ë¡œì§
  function addSkill() {
    const val = skillInput.value.trim();
    if (!val) return;
    
    // ì¤‘ë³µ ì²´í¬
    if (!skills.includes(val)) {
      skills.push(val);
      updateRealInput();
      renderTags();
    }
    skillInput.value = ''; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
    skillInput.focus();
  }

  // í™”ë©´ì— íƒœê·¸ ê·¸ë¦¬ê¸°
  function renderTags() {
    tagsContainer.innerHTML = '';
    skills.forEach((skill, index) => {
      const tag = document.createElement('span');
      tag.className = 'badge bg-info bg-opacity-10 text-info border border-info border-opacity-25 py-2 px-3 rounded-pill d-flex align-items-center';
      tag.innerHTML = `
        ${skill}
        <span class="ms-2 cursor-pointer text-white-50 hover-white" onclick="removeSkill(${index})" style="cursor:pointer;">&times;</span>
      `;
      tagsContainer.appendChild(tag);
    });
  }

  // íƒœê·¸ ì‚­ì œ (ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡í•´ì•¼ onclickì—ì„œ ì°¾ìŒ)
  window.removeSkill = function(index) {
    skills.splice(index, 1);
    updateRealInput();
    renderTags();
  };

  // ìˆ¨ê²¨ì§„ input ì—…ë°ì´íŠ¸ (DB ì „ì†¡ìš©)
  function updateRealInput() {
    realInput.value = skills.join(', ');
  }

  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: ì—”í„°í‚¤
  skillInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault(); // í¼ ì œì¶œ ë°©ì§€
      addSkill();
    }
  });

  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: ì¶”ê°€ ë²„íŠ¼
  addBtn.addEventListener('click', addSkill);
  
  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: datalist ì„ íƒ ì‹œ (input ì´ë²¤íŠ¸ í™œìš©)
  // ì‚¬ìš©ìê°€ ëª©ë¡ì—ì„œ í´ë¦­í•˜ë©´ ë°”ë¡œ ì¶”ê°€ë˜ê²Œ í•˜ë ¤ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ
  /*
  skillInput.addEventListener('input', function(e) {
     // datalist ì˜µì…˜ ì¤‘ì— í˜„ì¬ ì…ë ¥ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ê²Œ ìˆìœ¼ë©´ ìë™ ì¶”ê°€? 
     // (UX í˜¸ë¶ˆí˜¸ê°€ ìˆì–´ì„œ ì¼ë‹¨ Enter ì¹˜ëŠ” ë°©ì‹ìœ¼ë¡œ í†µì¼í•¨)
  });
  */
});
</script>

{% endblock %}